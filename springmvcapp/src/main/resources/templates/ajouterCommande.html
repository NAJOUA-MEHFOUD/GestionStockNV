<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ajouter Commande</title>
</head>
<body>
    <h1>Ajouter Commande</h1>
    <form action="/ajouterCommande" method="post">
        <div>
            <label for="date">Date:</label>
            <input type="date" id="date" name="date" required>
        </div>
        <div>
            <label for="client">Client:</label>
            <select id="client" name="client" required>
                <option th:each="client : ${clients}" th:value="${client.id}" th:text="${client.firstName + ' ' + client.lastName}"></option>
            </select>
        </div>
        <div>
            <label for="produitsCount">Nombre de produits:</label>
            <input type="number" id="produitsCount" name="produitsCount" min="1" required onchange="addProductInputs()">
        </div>
        <!-- Div pour contenir les champs d'entrée de produit -->
        <div id="produitsInputs"></div>
        <button type="submit">Ajouter Commande</button>
    </form>

    <script th:inline="javascript">
        function addProductInputs() {
            var produitsCount = document.getElementById('produitsCount').value;
            var produitsDiv = document.getElementById('produitsInputs');
            produitsDiv.innerHTML = ''; // Effacer les champs existants

            /* Thymeleaf boucle à travers les produits et génère les champs de produit */
            /* Supposons que produits est une liste d'objets Item */
            var produits = /*[[${produits}]]*/ null; // Ajout de Thymeleaf pour récupérer la liste des produits
            for (var i = 0; i < produitsCount; i++) {
                var produitSelect = document.createElement('select');
                produitSelect.name = 'produits[' + i + '].id';
                produitSelect.required = true;

                /* Ajouter des options pour chaque produit */
                produits.forEach(function(produit) {
                    var option = document.createElement('option');
                    option.value = produit.id;
                    option.textContent = produit.name; // Utiliser le nom du produit
                    produitSelect.appendChild(option);
                });

                var quantityInput = document.createElement('input');
                quantityInput.type = 'number';
                quantityInput.name = 'produits[' + i + '].quantity';
                quantityInput.placeholder = 'Quantité';
                quantityInput.required = true;

                produitsDiv.appendChild(produitSelect);
                produitsDiv.appendChild(quantityInput);
                produitsDiv.appendChild(document.createElement('br')); // Ajouter un saut de ligne
            }
        }
    </script>
</body>
</html>
